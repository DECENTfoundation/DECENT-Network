file(GLOB HEADERS  "../uvm/include/uvm/*.hpp" "../jsondiff/jsondiff-cpp/include/jsondiff/*.h"  )

add_custom_target( build_hardfork_hpp
                   COMMAND cat-parts "${CMAKE_CURRENT_SOURCE_DIR}/hardfork.d" "${CMAKE_CURRENT_BINARY_DIR}/include/graphene/chain/hardfork.hpp" )
set_source_files_properties( "${CMAKE_CURRENT_BINARY_DIR}/include/graphene/chain/hardfork.hpp" PROPERTIES GENERATED TRUE )

add_dependencies( build_hardfork_hpp cat-parts )

file(GLOB HEADERS "include/graphene/chain/*.hpp" "include/graphene/chain/protocol/*.hpp")

if( GRAPHENE_DISABLE_UNITY_BUILD )
   set( GRAPHENE_DB_FILES
        db_balance.cpp
        db_block.cpp
        db_debug.cpp
        db_getter.cpp
        db_init.cpp
        db_maint.cpp
        db_management.cpp
        db_decent.cpp
        db_update.cpp
        db_miner_schedule.cpp
      )
   message( STATUS "Graphene database unity build disabled" )
else( GRAPHENE_DISABLE_UNITY_BUILD )
   set( GRAPHENE_DB_FILES
        database.cpp )
   message( STATUS "Graphene database unity build enabled" )
endif( GRAPHENE_DISABLE_UNITY_BUILD )

## SORT .cpp by most likely to change / break compile
add_library( graphene_chain

             # As database takes the longest to compile, start it first
             ${GRAPHENE_DB_FILES}
             fork_database.cpp
             protocol/address.cpp
             protocol/types.cpp
             protocol/authority.cpp
             protocol/asset.cpp
             protocol/assert.cpp
             protocol/account.cpp
             protocol/transfer.cpp
             protocol/miner.cpp
             protocol/proposal.cpp
             protocol/withdraw_permission.cpp
             protocol/asset_ops.cpp
             protocol/memo.cpp
             protocol/custom.cpp
             protocol/operations.cpp
             protocol/transaction.cpp
             protocol/block.cpp
             protocol/fee_schedule.cpp

             protocol/vote.cpp
             protocol/decent.cpp
             protocol/subscription.cpp

             genesis_state.cpp
             get_config.cpp

             pts_address.cpp

             evaluator.cpp
             account_evaluator.cpp
             assert_evaluator.cpp
             miner_evaluator.cpp
             asset_evaluator.cpp
             transfer_evaluator.cpp
             proposal_evaluator.cpp
        vesting_balance_evaluator.cpp
             withdraw_permission_evaluator.cpp
        decent_evaluator.cpp
             subscription_evaluator.cpp
             custom_evaluator.cpp

             account_object.cpp
             asset_object.cpp
             content_object.cpp
             proposal_object.cpp
             vesting_balance_object.cpp
             transaction_detail_object.cpp
             message_object.cpp

             block_database.cpp

        contract.cpp
        content_object.cpp
        contract_engine.cpp
        contract_engine_builder.cpp
        contract_entry.cpp
        contract_evaluate.cpp
        referendum_evaluator.cpp
        referendum_object.cpp
        balance_evaluator.cpp
        protocol/referendum.cpp

        db_contract_trx.cpp

             ${HEADERS}
             "${CMAKE_CURRENT_BINARY_DIR}/include/graphene/chain/hardfork.hpp"
           )

add_dependencies( graphene_chain build_hardfork_hpp )

target_link_libraries( graphene_chain fc graphene_db decent_encrypt pbc uvm jsondiff )

if( WIN32 )
  target_link_libraries( graphene_chain ${GMP_LIBRARIES})
else()
  target_link_libraries( graphene_chain gmp uvm jsondiff )
endif()

target_include_directories(graphene_chain
                           PUBLIC
                           "${CMAKE_CURRENT_SOURCE_DIR}/include"
                           "${CMAKE_CURRENT_BINARY_DIR}/include"
        "${CMAKE_CURRENT_SOURCE_DIR}/../jsondiff/jsondiff-cpp/include")

if(MSVC)
  set_source_files_properties( db_init.cpp db_block.cpp database.cpp block_database.cpp PROPERTIES COMPILE_FLAGS "/bigobj" )
endif(MSVC)

#install( TARGETS
#   graphene_chain
#
#   RUNTIME DESTINATION bin
#   LIBRARY DESTINATION lib
#   ARCHIVE DESTINATION lib
#)
